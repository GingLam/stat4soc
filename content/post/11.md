---
date: "2021-08-01T11:05:05-05:00"
tags:
- 推断统计
- 相关分析
- 回归分析
- SPSS
title: 第十一节 相关分析与简单线性回归
---

#### 0. 预处理
*   **设置工作目录**
```spss
CD "/Users/ginglam/Public/data".
```
*   **导入2016年中国劳动力动态调查数据 (CLDS)**
```spss
GET FILE "clds2016_i.sav".
DATASET NAME clds.
DATASET ACTIVATE clds.
```
*   **数据准备**：在本讲中，我们将探究“教育年限”与“个人总收入”之间的关系。
    *   为满足后续分析的要求（特别是回归分析的正态性假设），我们将对收入变量进行对数转换。
    *   我们将学历变量转换为连续的教育年限变量。
```spss
* 筛选有效个案.
SELECT IF (I3a_6 > 0 AND I2_1 > 0).

* 对收入进行自然对数转换以缓解偏度.
COMPUTE log_income = LN(I3a_6).
VARIABLE LABELS log_income "总收入 (自然对数)".

* 将学历转换为教育年限.
RECODE I2_1 (1=0) (2=6) (3=9) (4 THRU 7=12) (8=15) (9=16) (10=19) (11=22) (ELSE=SYSMIS) INTO edu_year.
VARIABLE LABELS edu_year "最高教育年限".
EXECUTE.
```

---
### 第一部分：可视化与相关分析

#### 1. 相关关系的可视化：散点图
*   在进行任何数值计算之前，我们应该先通过**散点图**来直观地观察两个连续变量之间的关系。散点图可以告诉我们三件事：
    1.  **关系形态**：是线性关系还是曲线关系？
    2.  **关系方向**：是正相关（一个变量增大，另一个也随之增大）还是负相关？
    3.  **关系强度**：数据点是紧密围绕一条直线，还是松散地分布？

#### 案例（1-1）：描绘教育年限与总收入（对数）的散点图
```spss
GGRAPH
  /GRAPHDATASET NAME="graphdata" VARIABLES=edu_year log_income
  /GRAPHSPEC SOURCE=INLINE.
BEGIN GPL
  SOURCE: s = userSource(id("graphdata"))
  DATA: edu_year = col(source(s), name("edu_year"))
  DATA: log_income = col(source(s), name("log_income"))
  GUIDE: axis(dim(1), label("教育年限"))
  GUIDE: axis(dim(2), label("总收入 (对数)"))
  GUIDE: title(label("最高教育年限与总收入的关系 (2015)"))
  ELEMENT: point(position(edu_year*log_income), shape(shape.circle))
  ELEMENT: line(position(fit.line(edu_year*log_income)), shape(shape.solid)) /* 添加线性拟合线 */
END GPL.
```
![散点图](https://stat4soc.netlify.app/images/11.1.png)
*   **解读**：从散点图中我们可以初步看到，数据点大致呈现出从左下到右上的趋势，表明教育年限与对数收入之间可能存在一个**正向的线性关系**。

#### 2. 相关关系的量化（一）：协方差 (Covariance)
*   **协方差**是衡量两个变量**协同变化方向**的指标。
    *   **正协方差**：表示两个变量倾向于向**相同方向**变化。
    *   **负协方差**：表示两个变量倾向于向**相反方向**变化。
> **辅助知识点：协方差的局限性**
> 协方差有一个致命的弱点：它的**数值大小会受到变量原始单位的影响**。例如，用“元”计算的收入和用“万元”计算的收入，得到的协方差数值会相差一万倍，但这并不代表它们与教育的关系强度有任何不同。因此，协方差只告诉我们“方向”，却很难用来比较关系的“强度”。为了解决这个问题，我们引入了“相关系数”。

#### 案例（2-1）：求教育年限与对数收入的协方差
*   **方法一：理解原理 - 手动计算**
```spss
* 手动计算协方差公式: Cov(X,Y) = Σ[(xᵢ - x̄)(yᵢ - ȳ)] / (n-1)
AGGREGATE /OUTFILE=* MODE=ADDVARIABLES /log_income_mean=MEAN(log_income) /edu_year_mean=MEAN(edu_year).
COMPUTE cov_part = (log_income - log_income_mean) * (edu_year - edu_year_mean).
DATASET DECLARE result.
AGGREGATE /OUTFILE='result' /BREAK /N=N /cov_part_sum=SUM(cov_part).
DATASET ACTIVATE result.
COMPUTE income_edu_cov = cov_part_sum / (N - 1).
LIST income_edu_cov.
```
*   **方法二：实用语法 - `CORRELATIONS` 命令**
    *   这是获取协方差最直接的方法之一。
```spss
CORRELATIONS
  /VARIABLES=log_income edu_year
  /PRINT=TWOTAIL NOSIG /* 关闭显著性输出，简化表格 */
  /STATISTICS=XPROD. /* XPROD选项输出叉积和协方差 */
```
![协方差计算](https://stat4soc.netlify.app/images/11.5.png)
*   从“协方差”矩阵中可知，两个变量的协方差约为 **2.658**，是一个正值，印证了我们在散点图中观察到的正向关系。

#### 3. 相关关系的量化（二）：相关系数 (Correlation Coefficient)
*   **皮尔逊相关系数 (r)** 是对协方差进行**标准化**后的结果，它解决了协方差受单位影响的问题。
    *   `r` 的取值范围在 **-1 到 +1** 之间。
    *   `r = +1`: 完全正相关。
    *   `r = -1`: 完全负相关。
    *   `r = 0`:  没有**线性**关系。
    *   `|r|` 的绝对值大小表示了线性关系的强度。

#### 案例（3-1）：计算教育年限与对数收入的相关系数
*   **方法一：实用语法 - `CORRELATIONS` 命令 (推荐)**
```spss
CORRELATIONS
  /VARIABLES=log_income edu_year.
```
![相关分析结果](https://stat4soc.netlify.app/images/11.10.png)
*   **结果解读**：
    1.  **皮尔逊相关系数**：`r = 0.449`。这是一个中等强度的正相关。
    2.  **显著性 (Sig. 2-tailed)**：p值为 `.000`，远小于0.05。这表明我们观察到的这种相关性是**统计上显著的**，不太可能仅仅由抽样误差引起。
    3.  **N**：样本量为1369。

> **辅助知识点：相关不等于因果，更不等于“解释力”**
> 一个常见的重大误区是直接将相关系数 `r` 理解为“解释力”。`r = 0.449` **不等于** “教育年限解释了44.9%的收入”。
> 
> 正确的解释力指标是**决定系数 R² (R-Squared)**，即相关系数的平方。
> 
> 在本例中，`R² = (0.449)² ≈ 0.202`。这意味着，**教育年限的变异，可以解释对数收入变异的约20.2%**。剩下的近80%则是由其他未被模型包含的因素（如行业、经验、性别等）所解释。`R²` 是我们评价回归模型拟合优度的核心指标。

---
### 第二部分：简单线性回归分析

*   回归分析比相关分析更进一步。它不再仅仅描述关系，而是试图建立一个**预测模型**，并**量化**自变量对因变量的影响程度。
*   简单线性回归模型： $$ \hat{Y} = b_0 + b_1 X $$
    *   `Ŷ`: 因变量的**预测值** (Predicted value)，这里是`log_income`。
    *   `X`: 自变量 (Independent variable)，这里是`edu_year`。
    *   `b₀`: **截距 (Intercept/Constant)**，当X=0时，Y的预测值。
    *   `b₁`: **斜率 (Slope)**，X每增加一个单位，Y的预测值平均会发生多大的变化。这是我们最关心的系数。

#### 4.1 回归系数的点估计
*   **点估计**就是找出最优的`b₀`和`b₁`的值，使得模型预测值与真实值之间的总误差最小。这个方法被称为**普通最小二乘法 (Ordinary Least Squares, OLS)**。

#### 案例（4-1-1）：用教育年限回归对数收入
*   **实用语法 - `REGRESSION` 命令**
```spss
REGRESSION
  /DEPENDENT log_income
  /METHOD=ENTER edu_year
  /STATISTICS=COEFF.
```
![回归系数表](https://stat4soc.netlify.app/images/11.13.png)
*   **结果解读**：在“Coefficients”表中：
    *   **(Constant)** 对应的“B”列值是 **`b₀ = 8.653`**。
    *   **edu_year** 对应的“B”列值是 **`b₁ = 0.126`**。
*   **回归方程**：`预测的log_income = 8.653 + 0.126 * edu_year`。
*   **系数解释**：在其他条件不变的情况下，**教育年限每增加一年，我们预测其对数收入平均会增加0.126**。

#### 4.2 回归系数的区间估计
*   我们从样本中得到的`b₁=0.126`只是对真实总体斜率`β₁`的一个**点估计**。区间估计则为这个未知的`β₁`提供了一个具有一定置信度的范围。

#### 案例（4-2-1）：计算回归系数的95%置信区间
```spss
REGRESSION
  /DEPENDENT log_income
  /METHOD=ENTER edu_year
  /STATISTICS=CI(95). /* CI(95) 请求输出95%置信区间 */
```
![回归系数置信区间](https://stat4soc.netlify.app/images/11.16.png)
*   **结果解读**：在“Coefficients”表中新增了置信区间。
    *   `edu_year`系数的95%置信区间为 **[0.115, 0.137]**。
    *   **解释**：我们有95%的信心认为，真实的总体斜率`β₁`落在这个区间内。由于这个区间**完全不包含0**，这为我们“教育年限对收入有显著影响”的结论提供了更强的支持。

#### 4.3 模型的拟合优度
*   **决定系数R²** 是衡量模型整体解释力的核心指标。

#### 案例（4-3-1）：查看回归模型的拟合优度
```spss
REGRESSION
  /DEPENDENT log_income
  /METHOD=ENTER edu_year
  /STATISTICS=R.
```
![模型摘要表](https://stat4soc.netlify.app/images/11.18.png)
*   **结果解读**：在“Model Summary”表中：
    *   **R**：就是我们之前计算的相关系数`r=0.449`。
    *   **R Square (R²)**：`R² = 0.202`。这与我们手动计算的结果一致。
    *   **Adjusted R Square (调整后的R²)**：`0.201`。在多元回归中，这个指标比R²更可靠，因为它对模型中自变量的数量进行了惩罚。

#### 4.4 回归系数的假设检验
*   对于每个回归系数，我们都需要进行假设检验，以判断其影响是否在统计上显著。
*   **检验`b₁` (edu_year的系数)**：
    *   **H₀ (虚无假设)**：`β₁ = 0` (教育年限对收入没有线性影响)。
    *   **H₁ (研究假设)**：`β₁ ≠ 0`。
*   SPSS通过计算**t统计量**和对应的**p值**来完成这个检验。

#### 案例（4-4-1）：对回归系数进行假设检验
*   `REGRESSION`命令的默认输出已经包含了这部分结果。
![回归系数假设检验](https://stat4soc.netlify.app/images/11.21.png)
*   **结果解读**：在“Coefficients”表中，关注`edu_year`这一行：
    *   **t**：t统计量的值为 `21.992`，一个非常大的值。
    *   **Sig.**：p值为 `.000`，远小于0.05。
*   **结论**：我们**强烈拒绝虚无假设H₀**。样本证据充分表明，教育年限对对数收入存在显著的、正向的线性影响。
