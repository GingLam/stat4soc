---
date: "2021-08-01T11:05:05-05:00"
tags:
- 推断统计
- 相关分析
- 回归分析
- SPSS
title: 第十一节 相关分析与简单线性回归
---

#### 0. 预处理
*   **设置工作目录**
```spss
CD "/Users/ginglam/Public/data".
```
*   **导入2016年中国劳动力动态调查数据 (CLDS)**
```spss
GET FILE "clds2016_i.sav".
DATASET NAME clds.
DATASET ACTIVATE clds.
```
*   **数据准备**：在本讲中，我们将探究“教育年限”与“个人总收入”之间的关系。
    *   为满足后续分析的要求（特别是回归分析的正态性假设），我们将对收入变量进行对数转换。
    *   我们将学历变量转换为连续的教育年限变量。
```spss
* 筛选有效个案.
SELECT IF (I3a_6 > 0 AND I2_1 > 0).

* 对收入进行自然对数转换以缓解偏度.
COMPUTE log_income = LN(I3a_6).
VARIABLE LABELS log_income "总收入 (自然对数)".

* 将学历转换为教育年限.
RECODE I2_1 (1=0) (2=6) (3=9) (4 THRU 7=12) (8=15) (9=16) (10=19) (11=22) (ELSE=SYSMIS) INTO edu_year.
VARIABLE LABELS edu_year "最高教育年限".
EXECUTE.
```

---
### 第一部分：可视化与相关分析

#### 1. 相关关系的可视化：散点图
*   在进行任何数值计算之前，我们应该先通过**散点图**来直观地观察两个连续变量之间的关系。散点图可以告诉我们三件事：
    1.  **关系形态**：是线性关系还是曲线关系？
    2.  **关系方向**：是正相关（一个变量增大，另一个也随之增大）还是负相关？
    3.  **关系强度**：数据点是紧密围绕一条直线，还是松散地分布？

#### 案例（1-1）：描绘教育年限与总收入（对数）的散点图
*   **点选操作**：图形→图表构建器→从“图库”中选择“散点图/点图”并拖入画布→将“教育年限”拖入X轴→将“总收入（对数）”拖入Y轴→确定。
*   **语法操作**：
```spss
GGRAPH
  /GRAPHDATASET NAME="clds" VARIABLES=edu_year log_income
  /GRAPHSPEC SOURCE=INLINE.
BEGIN GPL
  SOURCE: clds = userSource(id("clds"))
  DATA: edu_year=col(source(clds), name("edu_year"))
  DATA: log_income=col(source(clds), name("log_income"))
  GUIDE: axis(dim(1), label("教育年限"))
  GUIDE: axis(dim(2), label("总收入（对数）"))
  GUIDE: title(label("2015年最高教育年限与总收入关系"))
  ELEMENT: point(position(edu_year*log_income))
  ELEMENT: line(position(fit.line(edu_year*log_income)), shape(shape.solid)) /* 添加线性拟合线 */
END GPL.
```
![散点图](https://stat4soc.netlify.app/images/11.1.png)
*   **解读**：从散点图中我们可以初步看到，数据点大致呈现出从左下到右上的趋势，表明教育年限与对数收入之间可能存在一个**正向的线性关系**。

#### 2. 相关关系的量化（一）：协方差 (Covariance)
*   **协方差**是衡量两个变量**协同变化方向**的指标。
    *   **正协方差**：表示两个变量倾向于向**相同方向**变化。
    *   **负协方差**：表示两个变量倾向于向**相反方向**变化。
> **辅助知识点：协方差的局限性**
> 协方差有一个致命的弱点，它的**数值大小会受到变量原始单位的影响**。例如，用“元”计算的收入和用“万元”计算的收入，得到的协方差数值会相差一万倍，但这并不代表它们与教育的关系强度有任何不同。因此，协方差只告诉我们“方向”，却很难用来比较关系的“强度”。为了解决这个问题，我们引入了“相关系数”。

*   **点选操作**
	*   **可靠性分析**：分析→标度→可靠性分析→将变量移入“项”→点击“统计”→勾选“协方差”。
	*   **双变量相关**：分析→相关→双变量→将变量移入“变量”→点击“选项”→勾选“叉积偏差和协方差”。

*   **语法操作**
   *   **可靠性分析**：reliability + /variables + “因变量” “自变量” + /statistics（统计量） + “descriptives（呈现描述统计量，包括均值、标准差和个案数）”、“cov（协方差）”、“corr（相关系数）”、“anova（方差分析）”
   *   **可靠性分析**：reliability + /variables + “因变量” “自变量” + /summary（汇总结果） + “means（均值）”、“corr（相关系数）”、“anova（方差分析）”
   *  **双变量相关**：correlations + /variables + “因变量” “自变量” + /statistics（统计量） + “descriptives（呈现描述统计量，包括均值、标准差和个案数）” 或 “xprod（呈现叉积偏差和协方差）” 或“all（呈现以上两种结果）”
   *   **线性回归**：regression + /descriptives（描述表） + “means（均值）”、“variance（方差）”、“stddev（标准差）”、“cov（协方差）”、“corr（相关系数）”、“xprod（叉积偏差）”、“sig（显著度）”、“N（个案数）”、“all（全部）” + /statistics（统计量） + “R（相关系数和判定系数）”+ “coeff（回归系数）” + “anova（方差分析）” + “ci()（置信区间，如90、95、99）” + /dependent + “自变量” + /method = “enter（输入）”、“stepwise（步进）”、“remove（除去）”、“backward（后退）”、“forward（前进）” + “因变量”.

#### 案例（2-1）：求教育年限与对数收入的协方差
*   **第一种方法：根据统计公式手动计算**
```spss
* 公式: Cov(X,Y) = Σ[(xᵢ - x̄)(yᵢ - ȳ)] / (n-1).
* 第一步：计算2015年总收入（对数）的均值.
AGGREGATE /OUTFILE=* MODE=ADDVARIABLES /log_income_mean=MEAN(log_income) /edu_year_mean=MEAN(edu_year).
* 第二步：计算2015年总收入（对数）实际值与均值离差.
COMPUTE log_income_diff = log_income - log_income_mean.
* 第三步：计算2015年最高教育年限的均值.
COMPUTE edu_year_diff = edu_year - edu_year_mean.
* 第四步：计算2015年最高教育年限实际值与均值的离差.
COMPUTE income_edu = log_income_diff*edu_year_diff.
* 第五步：创建新变量，使之等于总收入（对数）与最高教育年限的离差乘积.
AGGREGATE /OUTFILE=* MODE=ADDVARIABLES /income_edu_sum = SUM(income_edu) /N=N.
* 第六步：对总收入（对数）与最高教育年限的离差乘积求总和.
COMPUTE income_edu_cov = income_edu_sum / (N - 1).
* 第七步：用离差乘积之和除以自由度，得到两者的协方差.
SUMMARIZE /TABLES=income_edu_cov /FORMAT=VALIDLIST NOCASENUM /CELLS=FIRST.
```
![手动计算协方差](https://stat4soc.netlify.app/images/11.2.png)

*   **第二种方法：直接采用“可靠性分析”功能**
```spss
RELIABILITY
	/VARIABLES=log_income edu_year
	/STATISTICS=COV.
```
![可靠性分析-协方差1](https://stat4soc.netlify.app/images/11.3.png)

*   **第三种方法：采用“可靠性分析”的总结功能 (Summary)**
```spss
RELIABILITY
	/VARIABLES=log_income edu_year
	/SUMMARY=COV.
```
![可靠性分析-协方差2](https://stat4soc.netlify.app/images/11.4.png)

*   **第四种方法：采用“双变量相关”功能**
```spss
CORRELATIONS
	/VARIABLES=log_income edu_year
	/STATISTICS=XPROD.
```
![双变量相关-协方差](https://stat4soc.netlify.app/images/11.5.png)

*   **第五种方法：采用“线性回归”功能**
```spss
REGRESSION
	/DESCRIPTIVES=COV
	/DEPENDENT=log_income
	/METHOD=ENTER edu_year.
```
![线性回归-协方差](https://stat4soc.netlify.app/images/11.6.png)

*   由以上多种方法可知，2015年总收入（对数）与最高教育年限的协方差约为 **2.658**，是一个正值，印证了我们在散点图中观察到的正向关系。

#### 3. 关系的量化（二）：相关系数 (Correlation Coefficient)
*   **皮尔逊相关系数 (r)** 是对协方差进行**标准化**后的结果，它解决了协方差受单位影响的问题。
    *   `r` 的取值范围在 **-1 到 +1** 之间。
    *   `r = +1`: 完全正相关。
    *   `r = -1`: 完全负相关。
    *   `r = 0`:  没有**线性**关系。
    *   `|r|` 的绝对值大小表示了线性关系的强度。
*   **点选操作**
	*   **可靠性分析**：分析→标度→可靠性分析→将变量移入“项”→点击“统计”→勾选“相关性”。
	*   **双变量相关**：分析→相关→双变量→将变量移入“变量”→勾选“皮尔逊”。
	*   **线性回归**：分析→回归→线性→点击“统计”→勾选“模型拟合”。

#### 案例（3-1）：计算教育年限与对数收入的相关系数
*   **第一种方法：根据统计公式手动计算**
```spss
/* 接续手动计算协方差的步骤 */
AGGREGATE /OUTFILE=* MODE=ADDVARIABLES /log_income_sd=SD(log_income) /edu_year_sd=SD(edu_year).
COMPUTE income_edu_corr = income_edu_cov / (log_income_sd * edu_year_sd).
SUMMARIZE /TABLES=income_edu_corr /FORMAT=VALIDLIST NOCASENUM /CELLS=FIRST.
```
![手动计算相关系数](https://stat4soc.netlify.app/images/11.7.png)

*   **第二种方法：采用“可靠性分析”功能**
```spss
RELIABILITY
	/VARIABLES=log_income edu_year
	/STATISTICS=CORR.
```
![可靠性分析-相关1](https://stat4soc.netlify.app/images/11.8.png)

*   **第三种方法：采用“可靠性分析”功能 (Summary)**
```spss
RELIABILITY
	/VARIABLES=log_income edu_year
	/SUMMARY=CORR.
```
![可靠性分析-相关2](https://stat4soc.netlify.app/images/11.9.png)

*   **第四种方法：采用“双变量相关”功能 (推荐)**
```spss
CORRELATIONS
	/VARIABLES=log_income edu_year.
```
![双变量相关-相关](https://stat4soc.netlify.app/images/11.10.png)

*   **第五种方法：采用“线性回归”功能**
```spss
REGRESSION
	/STATISTICS=R
	/DEPENDENT=log_income
	/METHOD=ENTER edu_year.
```
![线性回归-相关](https://stat4soc.netlify.app/images/11.11.png)

*   **结果解读**：
    *   **皮尔逊相关系数 (r)**：`r = 0.449`。这是一个中等强度的正相关。
    *   **显著性 (Sig. 2-tailed)**：p值为 `.000`，远小于0.05。这表明我们观察到的这种相关性是**统计上显著的**。

> **辅助知识点：相关不等于因果，更不等于“解释力”**
> 一个常见的重大误区是直接将相关系数 `r` 理解为“解释力”。`r = 0.449` **不等于** “教育年限解释了44.9%的收入”。
> 
> 正确的解释力指标是**决定系数 R² (R-Squared)**，即相关系数的平方。
> 
> 在本例中，`R² = (0.449)² ≈ 0.202`。这意味着，**教育年限的变异，可以解释对数收入变异的约20.2%**。剩下的近80%则是由其他未被模型包含的因素（如行业、经验、性别等）所解释。`R²` 是我们评价回归模型拟合优度的核心指标。

---
### 第二部分：简单线性回归分析

*   回归分析比相关分析更进一步。它不再仅仅描述关系，而是试图建立一个**预测模型**，并**量化**自变量对因变量的影响程度。
*   简单线性回归模型： $$ \hat{Y} = b_0 + b_1 X $$
    *   `Ŷ`: 因变量的**预测值** (Predicted value)，这里是`log_income`。
    *   `X`: 自变量 (Independent variable)，这里是`edu_year`。
    *   `b₀`: **截距 (Intercept/Constant)**，当X=0时，Y的预测值。
    *   `b₁`: **斜率 (Slope)**，X每增加一个单位，Y的预测值平均会发生多大的变化。这是我们最关心的系数。

#### 4.1 回归系数的点估计
*   **点选操作**：分析→回归→线性→将`log_income`放入“因变量”，`edu_year`放入“自变量”→点击“统计”→确保勾选“估算值”→继续→确定。

#### 案例（4-1-1）：用教育年限回归对数收入
*   **第一种方法：根据最小二乘法的统计公式计算**
```spss
/* b1 = Cov(X,Y) / Var(X) */
/* b0 = Mean(Y) - b1 * Mean(X) */
COMPUTE beta_1 = income_edu_cov / (edu_year_sd**2).
COMPUTE beta_0 = log_income_mean - beta_1 * edu_year_mean.
SUMMARIZE /TABLES=beta_0 beta_1 /FORMAT=VALIDLIST NOCASENUM /CELLS=FIRST.
```
![手动计算回归系数](https://stat4soc.netlify.app/images/11.12.png)

*   **第二种方法：采用“线性回归”功能 (`REGRESSION`)**
```spss
REGRESSION
	/STATISTICS=COEFF
	/DEPENDENT=log_income
	/METHOD=ENTER edu_year.
```
![回归系数表](https://stat4soc.netlify.app/images/11.13.png)
*   **回归方程**：`预测的log_income = 8.653 + 0.126 * edu_year`。
*   **系数解释**：在其他条件不变的情况下，**教育年限每增加一年，我们预测其对数收入平均会增加0.126**。

#### 4.2 回归系数的区间估计
*   **点选操作**：分析→回归→线性→...→点击“统计”→勾选“置信区间”并设定水平(如95%)。

#### 案例（4-2-1）：计算回归系数的95%置信区间
*   **第一种方法：根据统计公式手动计算**
```spss
/* 这是一个复杂的过程，涉及计算残差平方和(SSE)和标准误(SE) */
COMPUTE log_income_hat = beta_0 + beta_1*edu_year.
COMPUTE residual = log_income - log_income_hat.
COMPUTE residual_sq = residual**2.
AGGREGATE /OUTFILE=* MODE=ADDVARIABLES /SSE = SUM(residual_sq).
* 计算模型方差和b1的标准误
COMPUTE model_var = SSE / (1369 - 2).
COMPUTE edu_year_diff_sq = (edu_year-edu_year_mean)**2.
AGGREGATE /OUTFILE=* MODE=ADDVARIABLES /edu_year_diff_sum=SUM(edu_year_diff_sq).
COMPUTE beta_1_se = SQRT(model_var / edu_year_diff_sum).
* 计算b1的置信区间
COMPUTE beta_1_lower = beta_1 - 1.96 * beta_1_se. /* 1.96为95%CI的Z值 */
COMPUTE beta_1_upper = beta_1 + 1.96 * beta_1_se.
/* b0的标准误计算更复杂，此处省略 */
SUMMARIZE /TABLES=beta_1 beta_1_se beta_1_lower beta_1_upper /FORMAT=VALIDLIST NOCASENUM /CELLS=FIRST.
```
![手动计算置信区间](https://stat4soc.netlify.app/images/11.14.png)

*   **第二种方法：采用“线性回归”功能 (推荐)**
```spss
REGRESSION
	/STATISTICS=CI(95)
	/DEPENDENT=log_income
	/METHOD=ENTER edu_year.
```
![回归置信区间](https://stat4soc.netlify.app/images/11.16.png)
*   **解释**：`edu_year`系数的95%置信区间为 **[0.115, 0.137]**。我们有95%的信心认为，真实的总体斜率`β₁`落在这个区间内。由于这个区间**完全不包含0**，这为我们“教育年限对收入有显著影响”的结论提供了更强的支持。

#### 4.3 拟合优度 (R²)
*   **点选操作**：分析→回归→线性→...→“统计”对话框默认勾选“模型拟合”。

#### 案例（4-3-1）：计算回归模型的拟合优度
*   **第一种方法：根据统计公式计算**
```spss
/* R_squared = SSR / SST,  SST = Σ(y-ȳ)², SSR = Σ(ŷ-ȳ)² */
COMPUTE SST = log_income_diff_sum.
COMPUTE log_income_hat_diff = log_income_hat - log_income_mean.
COMPUTE log_income_hat_diff_sq = log_income_hat_diff**2.
AGGREGATE /OUTFILE=* MODE=ADDVARIABLES /SSR=SUM(log_income_hat_diff_sq).
COMPUTE R_2 = SSR / SST.
SUMMARIZE /TABLES=R_2 /FORMAT=VALIDLIST NOCASENUM /CELLS=FIRST.
```
![手动计算R方](https://stat4soc.netlify.app/images/11.17.png)

*   **第二种方法：采用“线性回归”功能**
```spss
REGRESSION
	/STATISTICS=R
	/DEPENDENT=log_income
	/METHOD=ENTER edu_year.
```
![模型摘要](https://stat4soc.netlify.app/images/11.18.png)
*   **解读**：“Model Summary”表中的**R Square (R²)**值为 **0.202**。

#### 4.4 回归系数的假设检验
*   **点选操作**：分析→回归→线性→...→默认输出中包含系数检验结果。

#### 案例（4-4-1）：对回归系数值进行假设检验
*   **检验`b₁` (edu_year的系数)**：
    *   **H₀ (虚无假设)**：`β₁ = 0` (教育年限对收入没有线性影响)。
    *   **H₁ (研究假设)**：`β₁ ≠ 0`。
*   **第一种方法：根据统计公式计算**
```spss
/* t = b1 / SE(b1) */
COMPUTE beta_1_t = beta_1 / beta_1_se.
/* p-value */
COMPUTE beta_1_p = 2 * (1 - CDF.T(ABS(beta_1_t), 1369-2)).
SUMMARIZE /TABLES=beta_1_t beta_1_p /FORMAT=VALIDLIST NOCASENUM /CELLS=FIRST.
```
![手动计算t值和p值](https://stat4soc.netlify.app/images/11.19.png)

*   **第二种方法：采用“线性回归”功能**
```spss
REGRESSION
	/STATISTICS=COEFF
	/DEPENDENT=log_income
	/METHOD=ENTER edu_year.
```
![系数检验表](https://stat4soc.netlify.app/images/11.21.png)
*   **结果解读**：关注`edu_year`这一行，**Sig.**值为 `.000`，远小于0.05。我们**强烈拒绝虚无假设**，认为教育年限对对数收入存在显著的、正向的线性影响。
