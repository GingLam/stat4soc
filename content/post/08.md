---
date: "2021-08-01T16:05:05-05:00"
tags:
- 推断统计
- SPSS
- 可视化
title: 第八节 总体、样本与抽样分布
---

#### 核心概念梳理
> **辅助知识点：**
> 在进入推断统计的世界前，我们必须清晰地辨别三个长相相似但意义迥异的概念。这三者的关系是整个统计推断的基石。
> 
> 1.  **总体分布 (Population Distribution)**
>     *   **是什么？** 指的是我们所研究的**全体**对象中，某个变量的真实分布情况。例如，中国所有劳动力的真实收入分布。
>     *   **特点：** 这是我们最想知道的，但通常是**未知且不可得的**。因为我们几乎不可能去测量每一个个体。它的参数（如总体均值 μ、总体标准差 σ）是固定但未知的常数。
> 
> 2.  **样本分布 (Sample Distribution)**
>     *   **是什么？** 指的是我们从总体中**抽取出来的那一小部分**数据中，某个变量的分布情况。例如，CLDS调查中几千名受访者的收入分布。
>     *   **特点：** 这是我们**实际拥有的、看得见摸得着的**数据。我们通过分析样本分布，来**推断**总体分布的样貌。它的统计量（如样本均值 X̄、样本标准差 s）是已知的，但每次抽样都可能不同。
> 
> 3.  **抽样分布 (Sampling Distribution)**
>     *   **是什么？** 这是一个理论上的、抽象的分布。想象我们**从同一个总体中，反复抽取无数个大小相同（例如，n=200）的样本**。每一个样本都会有一个自己的均值。把这**无数个样本均值**收集起来，它们自身就会形成一个分布，这个分布就叫做“均值的抽样分布”。
>     *   **特点：** 这是连接样本与总体的**桥梁**。中央极限定理告诉我们，这个分布近似于正态分布。它的标准差有一个特殊的名字，叫做**标准误 (Standard Error)**。我们正是利用抽样分布的这个性质，来判断我们的样本结果在多大程度上是可靠的，并据此构建置信区间。

---

#### 0. 预处理
*   **设置工作目录**
```spss
CD "/Users/ginglam/Public/data".
```
*   **导入2016年中国劳动力动态调查数据 (CLDS)**
```spss
GET FILE "clds2016_i.sav".
DATASET NAME clds.
DATASET ACTIVATE clds.
```

#### 1. 管理输出查看器 (Output Viewer)
*   在进行大量分析时，保持输出结果窗口的整洁非常重要。
*   **注意**：SPSS的输出查看器没有“一键清空”按钮。一个有效的替代方法是关闭当前的查看器，再让SPSS自动生成一个新的。我们可以通过命名来管理它们。
```spss
* 给当前的输出窗口命名，方便后续引用.
OUTPUT NAME clds_output.

* 激活指定的输出窗口 (当打开多个窗口时有用).
OUTPUT ACTIVATE clds_output.

* 关闭指定的输出窗口，后续操作将自动打开一个干净的新窗口.
OUTPUT CLOSE clds_output.
```

#### 2. 图表构建器 (`GGRAPH` 与 `GPL`)
*   图表构建器是SPSS中功能最强大的绘图工具，它允许用户通过图形化界面或专门的“图形生产语言 (Graphics Production Language, GPL)”来精细控制图表的每一个细节。
*   **点选操作**：图形 -> 图表构建器 -> ...
*   **语法操作**：使用`GGRAPH`和`GPL`命令块。
    *   `GGRAPH`部分：负责定义用于绘图的数据集、变量和基本统计转换。
    *   `BEGIN GPL...END GPL.`部分：负责定义图表的具体视觉元素，如坐标轴、标题、几何形状（条形、线条等）。GPL内部的语法风格更接近其他编程语言，大小写敏感。

#### 案例（2-1）：绘制性别与平均收入的条形图
*   **准备工作**：筛选有效收入数据。
```spss
SELECT IF (I3a_6 >= 0).
COMPUTE income = I3a_6.
EXECUTE.
```
*   **绘图语法**：
```spss
GGRAPH
  /GRAPHDATASET NAME="graphdata" VARIABLES=gender MEAN(income)[NAME="mean_income"]
  /GRAPHSPEC SOURCE=INLINE.
BEGIN GPL
  SOURCE: s = userSource(id("graphdata"))
  DATA: gender = col(source(s), name("gender"), unit.category())
  DATA: mean_income = col(source(s), name("mean_income"))
  GUIDE: axis(dim(1), label("性别"))
  GUIDE: axis(dim(2), label("平均收入"))
  GUIDE: title(label("2015年不同性别的总收入"))
  GUIDE: subtitle(label("数据来源: CLDS 2016"))
  GUIDE: footnote(label("注: 已排除收入为负及缺失的个案"))
  ELEMENT: interval(position(gender*mean_income), label(mean_income)) /* label() 可在条形图上显示数值 */
END GPL.
```
![性别收入条形图](https://stat4soc.netlify.app/images/8.1.png)

#### 3. 绘制总体分布图 (Population Distribution)
*   在本案例中，我们将清理后的CLDS数据集**视为**我们的“总体”。我们将绘制这个总体中，收入变量的分布情况。

#### 案例（3-1）：绘制总收入的总体分布图
```spss
GGRAPH
  /GRAPHDATASET NAME="popdata" VARIABLES=income
  /GRAPHSPEC SOURCE=INLINE.
BEGIN GPL
  SOURCE: s = userSource(id("popdata"))
  DATA: income = col(source(s), name("income"))
  GUIDE: axis(dim(1), label("2015年总收入"))
  GUIDE: axis(dim(2), label("频数"))
  GUIDE: title(label("总体分布图 (Population Distribution)"))
  SCALE: linear(dim(1), min(0), max(1000000))
  ELEMENT: interval(position(summary.count(bin.rect(income, binWidth(10000))))) /* 绘制直方图，设定组距为10000 */
  ELEMENT: line(position(density.kernel.gaussian(income))) /* 叠加核密度估计曲线 */
END GPL.
```
![总体分布图](https://stat4soc.netlify.app/images/8.2.png)

*   **计算总体的真实参数**
```spss
* 使用 AGGREGATE 计算总体均值.
AGGREGATE
  /OUTFILE=* MODE=ADDVARIABLES
  /pop_income_mean = MEAN(income).

* 手动计算总体方差 (离差平方的均值).
COMPUTE diff_sq = (income - pop_income_mean)**2.
AGGREGATE
  /OUTFILE=* MODE=ADDVARIABLES
  /pop_income_var = MEAN(diff_sq).

* 计算总体标准差.
COMPUTE pop_income_sd = SQRT(pop_income_var).
EXECUTE.

* 使用 DESCRIPTIVES 查看计算出的总体参数 (只需看第一行).
SUMMARIZE
  /TABLES=pop_income_mean pop_income_var pop_income_sd
  /FORMAT=VALIDLIST NOCASENUM  TOTAL
  /TITLE='总体参数'
  /CELLS=FIRST.
```
![总体参数](https://stat4soc.netlify.app/images/8.3.png)

#### 4. 绘制样本分布图 (Sample Distribution)
*   现在，我们从“总体”中抽取一个**随机样本**，并观察这个样本的分布情况。
*   **设定随机种子**：为了让抽样结果可以复现，我们在抽样前设定一个种子。
```spss
SET SEED = 20220925.
```
*   **执行抽样**：从总体中随机抽取200个个案。
    *   **注意**：`SAMPLE`命令会永久性地改变当前数据集。在执行前务必保存原始数据。这里我们直接在筛选后的数据上操作。
```spss
* 计算总体中的有效个案数N，假设结果为1462.
SAMPLE 200 FROM 1462.
EXECUTE.
```
*   **绘制样本分布图** (GPL语法同上，仅修改标题)
```spss
GGRAPH
  /GRAPHDATASET NAME="sampledata" VARIABLES=income
  /GRAPHSPEC SOURCE=INLINE.
BEGIN GPL
  SOURCE: s = userSource(id("sampledata"))
  DATA: income = col(source(s), name("income"))
  GUIDE: axis(dim(1), label("2015年总收入"))
  GUIDE: axis(dim(2), label("频数"))
  GUIDE: title(label("样本分布图 (Sample Distribution)"))
  GUIDE: subtitle(label("样本规模 n = 200"))
  SCALE: linear(dim(1), min(0), max(1000000))
  ELEMENT: interval(position(summary.count(bin.rect(income, binWidth(10000)))))
  ELEMENT: line(position(density.kernel.gaussian(income)))
END GPL.
```
![样本分布图](https://stat4soc.netlify.app/images/8.4.png)
*   **计算样本统计量**
```spss
DESCRIPTIVES income 
  /STATISTICS=MEAN STDDEV VARIANCE.
```
> **思考**：比较样本的均值、标准差和总体参数，它们有多接近？如果重新抽一次样，结果会一样吗？答案是否定的，这正是“抽样误差”的体现。

#### 5. 绘制抽样分布图 (Sampling Distribution)
*   为了“看”到抽样分布，我们需要进行模拟。以下我们加载一个**预先模拟好的数据集** `income_sample.dta`。
*   **数据说明**：这个文件是通过编程，从我们的“总体”中反复抽样生成的。例如，`sam_income_100` 这一列，包含了500个数值，每个数值都是一次独立抽样（n=100）所得到的样本均值。
```spss
GET STATA FILE "simulation3/income_sample.dta".
```

#### 案例（5-1）：比较不同样本量下的抽样分布
*   **样本规模 n=100 的抽样分布**
```spss
GGRAPH
  /GRAPHDATASET NAME="dist100" VARIABLES=sam_income_100
  /GRAPHSPEC SOURCE=INLINE.
BEGIN GPL
  /* ... GPL代码与之前类似，仅替换变量名和标题 ... */
  GUIDE: title(label("抽样分布图 (Sampling Distribution)"))
  GUIDE: subtitle(label("样本规模 n = 100, 重复500次"))
  ELEMENT: interval(position(summary.count(bin.rect(sam_income_100, binWidth(1000)))))
  ELEMENT: line(position(density.kernel.gaussian(sam_income_100)))
END GPL.
```
![抽样分布n100](https://stat4soc.netlify.app/images/8.6.png)

*   **样本规模 n=500 的抽样分布**
```spss
GGRAPH
  /GRAPHDATASET NAME="dist500" VARIABLES=sam_income_500
  /GRAPHSPEC SOURCE=INLINE.
BEGIN GPL
  /* ... GPL代码与之前类似，仅替换变量名和标题 ... */
  GUIDE: subtitle(label("样本规模 n = 500, 重复500次"))
  ELEMENT: interval(position(summary.count(bin.rect(sam_income_500, binWidth(1000)))))
  ELEMENT: line(position(density.kernel.gaussian(sam_income_500)))
END GPL.
```
![抽样分布n500](https://stat4soc.netlify.app/images/8.8.png)

> **观察与结论**
> 比较不同样本规模下的抽样分布图，我们可以清晰地看到中央极限定理的效果：
> 1.  两个分布的中心都围绕在总体均值附近。
> 2.  当样本规模从100增大到500时，抽样分布明显变得**更高、更瘦**。这说明样本均值的波动范围变小了，即我们的估计变得**更精确**了。这个分布的标准差，就是**标准误**。

#### 6. 理解标准误 (Standard Error)
*   标准误是衡量抽样不确定性的核心指标。它告诉我们，样本统计量（如样本均值）在多次抽样中，平均会偏离总体参数（总体均值）多远。
*   **场景一：总体参数已知** (理论情况)
    *   标准误的计算公式为：$$ SE_{\bar{x}} = \frac{\sigma}{\sqrt{n}} $$ 其中, σ 是总体标准差, n 是样本大小。
*   **场景二：总体参数未知** (现实情况)
    *   我们用样本标准差 `s` 来估计总体标准差 `σ`。
    *   标准误的估计公式为：$$ \hat{SE}_{\bar{x}} = \frac{s}{\sqrt{n}} $$
    *   这个值，SPSS可以直接通过 `DESCRIPTIVES` 命令中的 `SEMEAN` 选项计算出来。
*   **注意：样本方差的贝塞尔校正 (Bessel's Correction)**
    *   当我们用样本来估计总体方差时，如果直接用样本的方差公式，会倾向于低估总体的真实方差。
    *   为了得到一个无偏估计，我们在计算样本方差时，分母使用 `n-1` 而不是 `n`。
    *   SPSS的所有标准统计程序（如`DESCRIPTIVES`, `T-TEST`等）在计算方差和标准差时，**默认都使用了 n-1 的校正**。
```spss
* 重新加载一个样本 (n=200) 来演示
GET FILE "clds2016_i.sav".
SELECT IF (I3a_6 >= 0).
SET SEED = 20220925.
SAMPLE 200 FROM 1462.
COMPUTE income = I3a_6.
* 让SPSS直接计算所有相关统计量
DESCRIPTIVES income 
  /STATISTICS=MEAN STDDEV VARIANCE SEMEAN.
```
![DESCRIPTIVES输出](https://stat4soc.netlify.app/images/8.13.png)
*   **解读**：输出结果中的 `SEMEAN` (均值标准误)，就是 SPSS 帮你计算好的 `s / sqrt(n)` 的值。

#### 7. 根据样本信息估计总体的置信区间
*   置信区间 (Confidence Interval) 是我们利用样本信息，对未知的总体参数给出的一个“区间估计”。
*   例如，一个“95%置信区间”意味着，如果我们反复用同样的方法进行抽样和计算，有95%的几率，我们构建出的这些区间会包含真实的总体参数。
*   **点选操作**：分析 -> 描述统计 -> 探索 -> ...
*   **语法操作**：使用 `EXAMINE` 命令。

#### 案例（7-1）：利用一个样本（n=200）估计总收入的95%置信区间
```spss
EXAMINE VARIABLES=income
  /PLOT NONE
  /STATISTICS DESCRIPTIVES
  /CINTERVAL 95.
```
![置信区间输出](https://stat4soc.netlify.app/images/8.14.png)
*   **解读**：在输出的“描述”表格中，找到“均值的95%置信区间”的“下限”和“上限”。这就是我们根据这200个样本数据，对总体平均收入给出的一个估计范围。

#### 随堂练习：根据2015年平均每周工作时间（I3a_1）计算其总体均值的95%置信区间。
> **练习参考答案**
> ```spss
> * 步骤一：准备数据.
> GET FILE "clds2016_i.sav".
> SELECT IF (I3a_1 > 0). /* 假设工作时间大于0为有效值 */
>
> * 步骤二：使用EXAMINE命令计算.
> EXAMINE VARIABLES=I3a_1
>  /PLOT NONE
>  /STATISTICS DESCRIPTIVES
>  /CINTERVAL 95.
> EXECUTE.
> ```

---
*附：抽样分布的理论形态（Stata绘图补充）*
> **辅助知识点：**
> 中央极限定理告诉我们抽样分布趋向于正态分布。如果我们知道了总体的均值和标准差，我们就能精确地画出这个理论上的正态分布曲线。
>
> **标准化与标准正态分布**
> 任何一个正态分布，都可以通过 `(X - μ) / σ` 的公式转换为一个均值为0，标准差为1的标准正态分布。这是进行假设检验（如t检验、Z检验）的理论基础。

![标准正态分布](https://stat4soc.netlify.app/images/8.16.png)
