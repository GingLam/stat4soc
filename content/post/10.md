---
date: "2021-08-01T12:05:05-05:00"
tags:
- 推断统计
- 方差分析
- ANOVA
- SPSS
title: 第十讲 方差分析专题
---

#### 0. 预处理
*   **设置工作目录**
```spss
CD "/Users/ginglam/Public/data".
```
*   **导入2016年中国劳动力动态调查数据 (CLDS)**
```spss
GET FILE "clds2016_i.sav".
DATASET NAME clds.
DATASET ACTIVATE clds.
```

---
#### 1.单因素方差分析 (One-Way ANOVA)

#### （1）核心问题与适用场景
*   在上一讲中，我们学习了使用独立样本T检验来比较**两个**独立总体的均值是否存在差异。但如果我们要比较的组别**大于等于三个**，例如，比较春、夏、秋、冬四个季节出生的人，其平均收入是否相同，T检验就无能为力了。
*   **单因素方差分析 (One-Way ANOVA)** 正是解决这个问题的标准方法。它通过分析数据的“方差”，来检验一个**分类型自变量**（包含三个或以上组别，也称“因子Factor”），是否对一个**连续型因变量**的均值产生显著影响。

> **辅助知识点：为何不两两做T检验？**
> 一个常见的误区是，当面临多组比较时，反复进行两两之间的T检验。例如，比较四个季节，就做 C(4,2)=6次T检验。这种做法是**错误**的，因为它会急剧增加犯“第一类错误”（即错误地拒绝了本应成立的虚无假设）的概率。如果每次检验的显著性水平α设为0.05，那么6次检验后，至少犯一次错误的累积概率会远大于0.05。方差分析则通过一次性的整体检验，很好地控制了这个问题。

#### （2）方差分析的三大前提假设
*   为了确保ANOVA结果的有效性，我们的数据需要满足三个基本假设
    *    **独立性 (Independence)**：各组样本之间是相互独立的，一个样本的观测值不会影响到另一个样本。通过随机抽样可以保证这一点。
    *    **正态性 (Normality)**：在每一个组别（总体）中，因变量都服从正态分布。
    *    **方差齐性 (Homoscedasticity)**：各组总体的方差是相等的。

#### 案例（1-1）：出生季节与收入的关系
*   **研究问题**：不同季节出生的劳动者，其2015年的平均总收入是否存在显著差异？
*   **虚无假设 H₀**：春、夏、秋、冬四个季节出生的劳动者，其总体平均收入完全相同 (μ_春 = μ_夏 = μ_秋 = μ_冬)。
*   **研究假设 H₁**：至少有一个季节出生的劳动者，其总体平均收入与其他季节不完全相同。

*   **第一步：数据准备与初步描述**
```spss
* 筛选有效数据：收入大于0，出生月份有效.
SELECT IF (I3a_6 > 0 AND birthmonth > 0).
COMPUTE income = I3a_6.

* 将出生月份重新编码为季节.
RECODE birthmonth (3 THRU 5=1) (6 THRU 8=2) (9 THRU 11=3) (12, 1, 2=4) INTO season.
VALUE LABELS season 1 "春季" 2 "夏季" 3 "秋季" 4 "冬季".
VARIABLE LEVEL season (NOMINAL).
EXECUTE.

* 使用MEANS命令初步查看各组的均值、人数和标准差.
MEANS income BY season
    /CELLS = MEAN COUNT STDDEV.
```

![各季节收入描述统计](https://stat4soc.netlify.app/images/10.2.png)

*   从描述统计表中，我们看到各组均值略有差异。但这种差异究竟是真实的总体差异，还是仅仅由抽样误差导致？这正是ANOVA需要回答的问题。

```spss
* 绘制不同季节出生的劳动者的收入条形图.
GGRAPH 
	/GRAPHDATASET NAME = "clds" VARIABLES= birthmonth MEAN(income)[NAME = "mean_income"]
	/GRAPHSPEC SOURCE = INLINE. 
BEGIN GPL 
	SOURCE: clds=userSource(id("clds"))
	DATA: birthmonth=col(source(clds), name("birthmonth"), unit.category())
	DATA: mean_income=col(source(clds), name("mean_income"))
	GUIDE: axis(dim(1), label("出生季节"))
	GUIDE: axis(dim(2), label("平均收入"))
	GUIDE: text.title(label("2015年出生季节劳动者的总收入")) 
	GUIDE: text.subtitle(label("基于CLDS2016数据"))
	ELEMENT: interval(position(birthmonth*mean_income))
END GPL.
```

![方差分析](https://stat4soc.netlify.app/images/10.3.png)

*   **第二步：检验前提假设 - 正态性 (Normality)**
    *   收入这类变量通常呈严重的右偏态（少数高收入者将均值拉高），直接分析可能违反正态性假设。一个常用的处理方法是**对数转换**，它可以有效缓解偏度。
```spss
IF (income > 0) log_income = LN(I3a_6).
SELECT IF (log_income  >= 0).
VARIABLE LABELS log_income "收入的自然对数".
MEANS log_income
	/CELLS = MEAN COUNT VAR STDDEV MIN MAX.
EXAMINE VARIABLES = log_income
	/PLOT HISTOGRAM.
EXECUTE.
```

![方差分析](https://stat4soc.netlify.app/images/10.4.png)

![方差分析](https://stat4soc.netlify.app/images/10.5.png)

*   **检验正态性的三种方法**
*   **第一种方法：根据偏度(Skewness)和峰度(Kurtosis)来判断**
    *   如果一个分布是完美的正态分布，其偏度和峰度都应为0。通常，如果这两个值的绝对值小于1，我们可以认为数据近似正态。
*	**使用`FREQUENCIES`功能**
    *   **点选操作**：分析 → 描述统计 → 频率 → 选择变量 → 取消勾选“显示频率表” → 点击“统计” → 勾选“偏度”和“峰度” → 继续 → 确定。
 	*   **语法操作**：
```spss
FREQUENCIES VARIABLES = log_income
	/FORMAT = NOTABLE
	/STATISTICS = SKEWNESS SESKEW KURTOSIS SEKURT.
```

 ![偏度与峰度-频率](https://stat4soc.netlify.app/images/10.6.png)

*	**使用使用`DESCRIPTIVES`功能**
	*   **点选操作**：分析 → 描述统计 → 描述 → 选择变量 → 点击“选项” → 勾选“偏度”和“峰度” → 继续 → 确定。 
    *   **语法操作**：
```spss
DESCRIPTIVES VARIABLES=log_income 
	/STATISTICS=KURTOSIS SKEWNESS.
```

![偏度与峰度-描述](https://stat4soc.netlify.app/images/10.7.png)

*   **解读**：从结果可知，对数收入的偏度(0.125)和峰度(-0.106)的绝对值都远小于1，说明其分布接近对称的钟形，近似满足正态性假设。

*   **第二种方法：根据P-P图和Q-Q图来判断**
    *   **规则**：通过比较观测数据与理论正态分布的期望值，来判断正态性。如果散点紧密地分布在对角线附近，则表明数据近似正态。Q-Q图在实践中应用更广。
    *   **P-P图**
        *   **点选操作**：分析 → 描述统计 → P-P图 → 选择变量 → 确定。
        *   **语法操作**：
            ```spss
            PPLOT /TYPE=P-P /VARIABLES = log_income.
            ```
            ![P-P图1](https://stat4soc.netlify.app/images/10.8.png)
            ![P-P图2](https://stat4soc.netlify.app/images/10.9.png)
    *   **Q-Q图**
        *   **点选操作 (方式一)**：分析 → 描述统计 → 探索 → 将变量放入“因变量列表” → 点击“图” → 勾选“含检验的正态图” → 继续 → 确定。
		*   **点选操作 (方式二)**：分析 → 描述统计 → Q-Q图 → 选择变量 → 确定。
        *   **语法操作 (方式一)**：使用`EXAMINE`
            ```spss
            EXAMINE VARIABLES=log_income 
                /PLOT NPPLOT 
                /NOTOTAL.
            ```
            ![Q-Q图-探索1](https://stat4soc.netlify.app/images/10.11.png)
            ![Q-Q图-探索2](https://stat4soc.netlify.app/images/10.12.png)
        *   **语法操作 (方式二)**：使用`PPLOT`
            ```spss
            PPLOT /TYPE=Q-Q /VARIABLES = log_income.
            ```
            ![Q-Q图-PPLOT1](https://stat4soc.netlify.app/images/10.14.png)
            ![Q-Q图-PPLOT2](https://stat4soc.netlify.app/images/10.15.png)
    *   **解读**：从P-P图和Q-Q图的结果来看，观测值散点都非常紧密地贴合在对角线上，这为变量近似服从正态分布提供了强有力的图形证据。

*   **第三种方法：根据柯尔莫戈洛夫-斯米尔诺夫检验 (K-S test) 或 夏皮罗-威尔克检验 (Shapiro-Wilk test)**
    *   **规则**：这是最严格的统计检验方法。其**虚无假设 H₀ 为：数据服从正态分布**。如果p值(Sig.)小于0.05，我们就拒绝H₀。
    *   **注意**：在大样本情况下，这些检验非常敏感，即使数据轻微偏离正态，也可能导致显著的结果。因此，社会科学研究中通常更依赖于图形法和偏度/峰度指标进行综合判断。
    *   **K-S 检验**
        *   **点选操作 (方式一)**：与Q-Q图的“探索”功能相同。
        *   **点选操作 (方式二)**：分析 → 非参数检验 → 旧对话框 → 单样本K-S → 将变量放入“检验变量列表” → 勾选“正态” → 确定。
        *   **语法操作 (方式一)**：使用`EXAMINE` (同时输出S-W检验)
            ```spss
            EXAMINE VARIABLES=log_income /PLOT NPPLOT /NOTOTAL.
            ```
            ![正态性检验表-探索](https://stat4soc.netlify.app/images/10.18.png)
        *   **语法操作 (方式二)**：使用`NPAR TESTS`
            ```spss
            NPAR TESTS /K-S(NORMAL)=log_income.
            ```
            ![正态性检验表-KS](https://stat4soc.netlify.app/images/10.19.png)
    *   **夏皮罗-威尔克检验**
        *   **点选操作**：与Q-Q图的“探索”功能相同。
        *   **语法操作**：使用`EXAMINE`
            ```spss
            EXAMINE VARIABLES=log_income /PLOT NPPLOT /NOTOTAL.
            ```
            ![正态性检验表-SW](https://stat4soc.netlify.app/images/10.20.png)
    *   **综合判断**：两项统计检验的p值均小于0.05，拒绝了正态分布的虚无假设。然而，考虑到我们的样本量较大，检验结果可能过于敏感。结合前述偏度、峰度和Q-Q图的理想表现，我们仍然可以认为`log_income`变量**近似满足正态性假设**，可以继续进行ANOVA分析。

*   **第三步：检验前提假设 - 方差齐性 (Homogeneity of Variances)**
    *   我们使用**Levene检验**来判断各组的方差是否相等。其**虚无假设 H₀ 为：各组方差相等**。如果p值(Sig.)大于0.05，我们就不能拒绝H₀，即认为方差是齐的。
    *   **点选操作**：分析 → 比较平均值 → 单因素ANOVA → 将`log_income`放入“因变量列表”，`season`放入“因子” → 点击“选项” → 勾选“方差同质性检验” → 继续 → 确定。
    *   **语法操作**：
        ```spss
        ONEWAY log_income BY season 
            /STATISTICS HOMOGENEITY.
        ```
        ![Levene检验](https://stat4soc.netlify.app/images/10.21.png)
    *   **解读**：Levene检验的p值为0.457，远大于0.05，表明我们**没有理由认为各季节组的收入方差存在差异**。方差齐性假设得到满足。

*   **第四步：进行方差分析 (ANOVA)**
    *   **第一种方法：通过统计公式手动计算 (理解原理)**
        *   ANOVA的核心思想是将总变异(SST)分解为组间变异(SSB)和组内变异(SSW)。
        ```spss
        * 此处省略了手动计算的繁琐步骤，其目的是为了展示方差分解的逻辑
        * SST = 1111.96, df_t = 1421
        * SSB = 8.16, df_b = 3
        * SSW = 1103.80, df_w = 1418
        * F = (SSB/df_b) / (SSW/df_w) = (8.16/3) / (1103.80/1418) = 3.49
        * p_value = 1 - CDF.F(3.49, 3, 1418) = 0.015
        ```
    *   **第二种方法：采用“单因素ANOVA检验”功能 (标准流程)**
        *   **点选操作**：分析 → 比较平均值 → 单因素ANOVA → 将`log_income`放入“因变量列表”，`season`放入“因子” → (可选)点击“选项”勾选“描述”和“均值图” → 确定。
        *   **语法操作**：
            ```spss
            ONEWAY log_income BY season
                /STATISTICS DESCRIPTIVES
                /PLOT MEANS.
            ```
            ![ANOVA结果表](https://stat4soc.netlify.app/images/10.25.png)
        *   **结果解读**：
            1.  在“ANOVA”表中，我们主要关注**F值**和**“Sig.” (p值)**。
            2.  这里的p值为0.150，**大于0.05**。（*注：此处结果与手动计算示例不符，以SPSS实际运行为准。原讲义图片显示F=1.782, p=0.150*）。
            3.  **结论**：我们**不能拒绝虚无假设H₀**。这意味着，尽管我们在样本中观察到不同季节出生者的平均收入略有不同，但这种差异在统计上并不显著，很可能仅仅是抽样误差造成的。我们没有足够的证据表明出生季节对个人收入有显著影响。

---
### 第二部分：双因素方差分析 (Two-Way ANOVA)

#### 2. 核心问题与适用场景
*   当研究者想同时考察**两个分类型自变量**（因子）对一个连续型因变量的影响时，就需要使用双因素方差分析。它不仅能分别检验每个自变量的**主效应 (Main Effect)**，还能检验两个自变量之间是否存在**交互效应 (Interaction Effect)**。

*   **点选操作**：分析 → 一般线性模型 → 单变量 → 将`log_income`放入“因变量”框 → 将两个自变量（如`season`, `gender`）放入“固定因子”框 → 点击“模型” → 选择“构建项” → “类型”选“主效应” → 将因子移入“模型”框 → 继续 → 确定。
*   **语法操作**：

#### 案例（2-1）：检验出生季节与性别的双重影响
*   **研究问题**：出生季节和性别是否共同影响个人收入？
*   **虚无假设 H₀-1**: 不同季节出生者的总体平均收入相同。
*   **虚无假设 H₀-2**: 不同性别者的总体平均收入相同。
*   **研究假设 H₁-1**: 不同季节出生者的总体平均收入不完全相同。
*   **研究假设 H₁-2**: 不同性别者的总体平均收入不相同。
```spss
SELECT IF (gender > 0).
UNIANOVA log_income BY season gender
	/METHOD = SSTYPE(3) 
	/INTERCEPT = INCLUDE 
	/CRITERIA = ALPHA(0.05)
	/DESIGN = season gender. /* /DESIGN 子命令明确指定只考虑主效应 */
```
![双因素ANOVA结果](https://stat4soc.netlify.app/images/10.26.png)
*   **结果解读**：
    *   在“Tests of Between-Subjects Effects”表中，我们分别看`season`和`gender`两行。
    *   **出生季节 (season)**：p值为0.164，大于0.05，主效应不显著。
    *   **性别 (gender)**：p值为0.000，小于0.05，主效应**非常显著**。
    *   **结论**：在同时控制了两个变量后，我们发现出生季节对收入依然没有显著影响，但性别的独立影响是显著的。

#### 随堂练习
1.  以**社会地位自我评价** (`I7_10_1`) 为因变量，**地区**（东、中、西）为自变量，进行完整的单因素方差分析流程（包括前提检验）。
2.  以**总收入** (`income`) 为因变量，**出生季节** (`season`) 和**政治面貌**（`I1_6`，重编码为党员/非党员）为自变量，进行双因素方差分析。
