---
date: "2021-08-01T12:05:05-05:00"
tags:
- 推断统计
- 方差分析
- ANOVA
- SPSS
title: 第十讲 方差分析专题
---

#### 0. 预处理
*   **设置工作目录**
```spss
CD "/Users/ginglam/Public/data".
```
*   **导入2016年中国劳动力动态调查数据 (CLDS)**
```spss
GET FILE "clds2016_i.sav".
DATASET NAME clds.
DATASET ACTIVATE clds.
```

---
#### 1.单因素方差分析 (One-Way ANOVA)

#### （1）核心问题与适用场景
*   在上一讲中，我们学习了使用独立样本T检验来比较**两个**独立总体的均值是否存在差异。但如果我们要比较的组别**大于等于三个**，例如，比较春、夏、秋、冬四个季节出生的人，其平均收入是否相同，T检验就无能为力了。
*   **单因素方差分析 (One-Way ANOVA)** 正是解决这个问题的标准方法。它通过分析数据的“方差”，来检验一个**分类型自变量**（包含三个或以上组别，也称“因子Factor”），是否对一个**连续型因变量**的均值产生显著影响。

> **辅助知识点：为何不两两做T检验？**
> 一个常见的误区是，当面临多组比较时，反复进行两两之间的T检验。例如，比较四个季节，就做 C(4,2)=6次T检验。这种做法是**错误**的，因为它会急剧增加犯“第一类错误”（即错误地拒绝了本应成立的虚无假设）的概率。如果每次检验的显著性水平α设为0.05，那么6次检验后，至少犯一次错误的累积概率会远大于0.05。方差分析则通过一次性的整体检验，很好地控制了这个问题。

#### （2）方差分析的三大前提假设
*   为了确保ANOVA结果的有效性，我们的数据需要满足三个基本假设
    *    **独立性 (Independence)**：各组样本之间是相互独立的，一个样本的观测值不会影响到另一个样本。通过随机抽样可以保证这一点。
    *    **正态性 (Normality)**：在每一个组别（总体）中，因变量都服从正态分布。
    *    **方差齐性 (Homoscedasticity)**：各组总体的方差是相等的。

#### 案例（1-1）：出生季节与收入的关系
*   **研究问题**：不同季节出生的劳动者，其2015年的平均总收入是否存在显著差异？
*   **虚无假设 H₀**：春、夏、秋、冬四个季节出生的劳动者，其总体平均收入完全相同 (μ_春 = μ_夏 = μ_秋 = μ_冬)。
*   **研究假设 H₁**：至少有一个季节出生的劳动者，其总体平均收入与其他季节不完全相同。

*   **第一步：数据准备与初步描述**
```spss
* 筛选有效数据：收入大于0，出生月份有效.
SELECT IF (I3a_6 > 0 AND birthmonth > 0).
COMPUTE income = I3a_6.

* 将出生月份重新编码为季节.
RECODE birthmonth (3 THRU 5=1) (6 THRU 8=2) (9 THRU 11=3) (12, 1, 2=4) INTO season.
VALUE LABELS season 1 "春季" 2 "夏季" 3 "秋季" 4 "冬季".
VARIABLE LEVEL season (NOMINAL).
EXECUTE.

* 使用MEANS命令初步查看各组的均值、人数和标准差.
MEANS income BY season
    /CELLS = MEAN COUNT STDDEV.
```

![各季节收入描述统计](https://stat4soc.netlify.app/images/10.2.png)

*   从描述统计表中，我们看到各组均值略有差异。但这种差异究竟是真实的总体差异，还是仅仅由抽样误差导致？这正是ANOVA需要回答的问题。

```spss
* 绘制不同季节出生的劳动者的收入条形图.
GGRAPH 
	/GRAPHDATASET NAME = "clds" VARIABLES= birthmonth MEAN(income)[NAME = "mean_income"]
	/GRAPHSPEC SOURCE = INLINE. 
BEGIN GPL 
	SOURCE: clds=userSource(id("clds"))
	DATA: birthmonth=col(source(clds), name("birthmonth"), unit.category())
	DATA: mean_income=col(source(clds), name("mean_income"))
	GUIDE: axis(dim(1), label("出生季节"))
	GUIDE: axis(dim(2), label("平均收入"))
	GUIDE: text.title(label("2015年出生季节劳动者的总收入")) 
	GUIDE: text.subtitle(label("基于CLDS2016数据"))
	ELEMENT: interval(position(birthmonth*mean_income))
END GPL.
```

![方差分析](https://stat4soc.netlify.app/images/10.3.png)

*   **第二步：检验前提假设 - 正态性 (Normality)**
    *   收入这类变量通常呈严重的右偏态（少数高收入者将均值拉高），直接分析可能违反正态性假设。一个常用的处理方法是**对数转换**，它可以有效缓解偏度。
```spss
IF (income > 0) log_income = LN(I3a_6).
SELECT IF (log_income  >= 0).
VARIABLE LABELS log_income "收入的自然对数".
MEANS log_income
	/CELLS = MEAN COUNT VAR STDDEV MIN MAX.
EXAMINE VARIABLES = log_income
	/PLOT HISTOGRAM.
EXECUTE.
```

![方差分析](https://stat4soc.netlify.app/images/10.4.png)

![方差分析](https://stat4soc.netlify.app/images/10.5.png)

*   **检验正态性的三种方法**
    *   **方法一：查看偏度(Skewness)和峰度(Kurtosis)**。
    *   如果一个分布是完美的正态分布，其偏度和峰度都应为0。通常，如果这两个值的绝对值小于1，我们可以认为数据近似正态。
```spss
FREQUENCIES log_income
    /FORMAT=NOTABLE
    /STATISTICS=SKEWNESS SESKEW KURTOSIS SEKURT.
```
![偏度与峰度](https://stat4soc.netlify.app/images/10.6.png)


        2.  **方法二：图形法 (P-P图 / Q-Q图)**
            *   P-P图和Q-Q图通过比较观测数据的累积概率（或分位数）与理论正态分布的期望值，来判断正态性。如果散点紧密地分布在对角线附近，则表明数据近似正态。
            ```spss
            PPLOT /TYPE=Q-Q /VARIABLES=log_income.
            ```
            ![Q-Q图](https://stat4soc.netlify.app/images/10.14.png)
        3.  **方法三：正态性检验 (K-S检验 / S-W检验)**
            *   这是最严格的检验方法。其**虚无假设 H₀ 为：数据服从正态分布**。如果p值(Sig.)小于0.05，我们就拒绝H₀，认为数据不服从正态分布。
            *   **注意**：在大样本情况下，这些检验非常敏感，即使数据轻微偏离正态，也可能导致显著的结果。因此，社会科学研究中通常更依赖于图形法和偏度/峰度指标进行综合判断。
            ```spss
            EXAMINE log_income /PLOT=NPPLOT /STATISTICS=NONE.
            ```
            ![正态性检验](https://stat4soc.netlify.app/images/10.20.png)
    *   **综合判断**：虽然严格的S-W检验结果显著（p<0.05），但考虑到Q-Q图上的点基本贴合直线，且偏度和峰度值较小，我们可以认为对数转换后的收入变量**近似满足正态性假设**，可以继续进行ANOVA分析。

*   **第三步：检验前提假设 - 方差齐性 (Homogeneity of Variances)**
    *   我们使用**Levene检验**来判断各组的方差是否相等。其**虚无假设 H₀ 为：各组方差相等**。如果p值(Sig.)大于0.05，我们就不能拒绝H₀，即认为方差是齐的。
    ```spss
    ONEWAY log_income BY season /STATISTICS=HOMOGENEITY.
    ```
    ![Levene检验](https://stat4soc.netlify.app/images/10.21.png)
    *   **结果解读**：Levene检验的p值为0.739，远大于0.05，表明我们**没有理由认为各季节组的收入方差存在差异**。方差齐性假设得到满足。

*   **第四步：执行单因素方差分析 (ANOVA)**
    *   **核心逻辑**：ANOVA通过比较“组间方差”（由自变量分组带来的差异）和“组内方差”（由随机误差带来的差异）来做出判断。如果组间方差显著大于组内方差，我们就认为自变量对因变量有影响。这个比较的比值就是**F统计量**。
    ```spss
    ONEWAY log_income BY season /STATISTICS=DESCRIPTIVES /PLOT=MEANS.
    ```
    ![ANOVA结果表](https://stat4soc.netlify.app/images/10.25.png)
    *   **结果解读**
        1.  在“ANOVA”表中，我们主要关注**F值**和 **“Sig.” (p值)**。
        2.  这里的p值为0.150，**大于0.05**。
        3.  **结论**：我们**不能拒绝虚无假设H₀**。这意味着，尽管我们在样本中观察到不同季节出生者的平均收入略有不同，但这种差异在统计上并不显著，很可能仅仅是抽样误差造成的。我们没有足够的证据表明出生季节对个人收入有显著影响。

-------------------

### 第二部分：双因素方差分析 (Two-Way ANOVA)

#### 2. 核心问题与适用场景
*   当研究者想同时考察**两个分类型自变量**（因子）对一个连续型因变量的影响时，就需要使用双因素方差分析。
*   它不仅能分别检验每个自变量的**主效应 (Main Effect)**，还能检验两个自变量之间是否存在**交互效应 (Interaction Effect)**。
    > **辅助知识点：什么是交互效应？**
    > 交互效应指的是，一个自变量对因变量的影响效果，会因为另一个自变量取值的不同而发生改变。例如，某种药物对男性有效，但对女性无效，这就是药物与性别的交互效应。如果只做单因素分析，这种复杂的模式可能会被忽略。

#### 案例（2-1）：出生季节与性别的双重影响
*   **研究问题**：出生季节和性别是否共同影响个人收入？
*   **语法操作**：使用`UNIANOVA` (Univariate General Linear Model) 命令。
```spss
UNIANOVA log_income BY season gender
  /METHOD = SSTYPE(3)
  /INTERCEPT = INCLUDE
  /CRITERIA = ALPHA(0.05)
  /DESIGN = season gender. /* 这里只考虑主效应，不考虑交互项 */
```
![双因素ANOVA结果](https://stat4soc.netlify.app/images/10.26.png)
*   **结果解读**
    *   在“Tests of Between-Subjects Effects”表中，我们分别看`season`和`gender`两行。
    *   **出生季节 (birthmonth)**：p值为0.164，大于0.05，主效应不显著。
    *   **性别 (gender)**：p值为0.000，小于0.05，主效应**非常显著**。
    *   **结论**：在同时控制了出生季节和性别后，我们发现出生季节对收入依然没有显著影响，但性别的独立影响是显著的。

#### 随堂练习
1.  采用以上三种方法，检验**教育年限** (`I2_1`转换后) 是否满足正态性假设。
2.  检验从事不同产业（`I3a_8`：第一、二、三产业）的劳动者，其**教育年限**的方差是否齐整。
3.  以**社会地位自我评价** (`I7_10_1`) 为因变量，**地区**（东、中、西）为自变量，进行单因素方差分析。
    *   提示：需要先根据省份编码 `PROV2016` 创建地区变量。
